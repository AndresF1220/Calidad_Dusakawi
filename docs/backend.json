{
  "entities": {
    "Dashboard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Dashboard",
      "type": "object",
      "description": "Represents a quality dashboard for Dusakawi EPSI, displaying key metrics and performance indicators.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Dashboard entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the dashboard."
        },
        "description": {
          "type": "string",
          "description": "Description of the dashboard."
        },
        "layoutConfig": {
          "type": "string",
          "description": "JSON configuration for the dashboard layout, specifying the arrangement of widgets and data visualizations."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Dashboard).  The user who owns/created the dashboard."
        }
      },
      "required": [
        "id",
        "name",
        "layoutConfig",
        "userId"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a quality report generated within Dusakawi Quality Central.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the report."
        },
        "description": {
          "type": "string",
          "description": "Description of the report."
        },
        "reportType": {
          "type": "string",
          "description": "Type of report (e.g., Daily, Weekly, Monthly)."
        },
        "dateGenerated": {
          "type": "string",
          "description": "Date and time the report was generated.",
          "format": "date-time"
        },
        "queryParameters": {
          "type": "string",
          "description": "JSON string representing the query parameters used to generate the report."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Report).  The user who generated the report."
        }
      },
      "required": [
        "id",
        "name",
        "reportType",
        "dateGenerated",
        "queryParameters",
        "userId"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents a customizable alert for critical quality deviations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Alert entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the alert."
        },
        "description": {
          "type": "string",
          "description": "Description of the alert."
        },
        "metric": {
          "type": "string",
          "description": "The quality metric being monitored (e.g., defect rate, customer satisfaction)."
        },
        "threshold": {
          "type": "number",
          "description": "Threshold value that triggers the alert."
        },
        "severity": {
          "type": "string",
          "description": "Severity level of the alert (e.g., Low, Medium, High)."
        },
        "notificationChannel": {
          "type": "string",
          "description": "The notification method (e.g., email, SMS)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Alert).  The user who configured the alert."
        }
      },
      "required": [
        "id",
        "name",
        "metric",
        "threshold",
        "severity",
        "notificationChannel",
        "userId"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents user feedback regarding KPIs.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Feedback entity."
        },
        "kpi": {
          "type": "string",
          "description": "The key performance indicator the feedback is related to."
        },
        "rating": {
          "type": "number",
          "description": "User rating for the KPI."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment provided by the user."
        },
        "dateSubmitted": {
          "type": "string",
          "description": "Date and time the feedback was submitted.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Feedback). The user who submitted the feedback."
        }
      },
      "required": [
        "id",
        "kpi",
        "rating",
        "dateSubmitted",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Dusakawi Quality Central application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the user."
        },
        "role": {
          "type": "string",
          "description": "Role of the user within the application (e.g., Administrator, Analyst, User)."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "fullName",
        "role"
      ]
    },
    "File": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "File",
      "type": "object",
      "description": "Represents a file uploaded to the system, likely related to reporting or analysis.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the File entity."
        },
        "filename": {
          "type": "string",
          "description": "The original name of the uploaded file."
        },
        "fileType": {
          "type": "string",
          "description": "The MIME type of the file (e.g., application/pdf, image/jpeg)."
        },
        "fileSize": {
          "type": "number",
          "description": "The size of the file in bytes."
        },
        "uploadDate": {
          "type": "string",
          "description": "The date and time the file was uploaded.",
          "format": "date-time"
        },
        "storageLocation": {
          "type": "string",
          "description": "The location where the file is stored (e.g., cloud storage URL, local file path)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N File). The user who uploaded the file."
        }
      },
      "required": [
        "id",
        "filename",
        "fileType",
        "fileSize",
        "uploadDate",
        "storageLocation",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user profiles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dashboards/{dashboardId}",
        "definition": {
          "entityName": "Dashboard",
          "schema": {
            "$ref": "#/backend/entities/Dashboard"
          },
          "description": "Collection to store dashboards owned by a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who owns the dashboard."
            },
            {
              "name": "dashboardId",
              "description": "The unique identifier for the dashboard."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Collection to store reports generated by a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who created the report."
            },
            {
              "name": "reportId",
              "description": "The unique identifier for the report."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Collection to store alerts configured by a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who configured the alert."
            },
            {
              "name": "alertId",
              "description": "The unique identifier for the alert."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/feedback/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Collection to store feedback submitted by a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who submitted the feedback."
            },
            {
              "name": "feedbackId",
              "description": "The unique identifier for the feedback entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/files/{fileId}",
        "definition": {
          "entityName": "File",
          "schema": {
            "$ref": "#/backend/entities/File"
          },
          "description": "Collection to store files uploaded by a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user who uploaded the file."
            },
            {
              "name": "fileId",
              "description": "The unique identifier for the file."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It leverages structural segregation and access modeling to simplify security rules and maintain data integrity.\n\n**Authorization Independence:**\nUser-owned data (Dashboards, Reports, Alerts, Feedbacks, and Files) is stored under the `/users/{userId}` path, eliminating the need for `get()` calls in security rules to check ownership. This ensures atomic operations and simplifies debugging. No membership maps are required, as the path inherently defines ownership.\n\n**Structural Segregation:**\nEach entity type is stored in its own collection. User-specific data is placed under the `/users/{userId}` collection to clearly segregate data based on ownership. This segregation strategy simplifies security rules by ensuring that all documents within a given collection share the same security posture.\n\n**Access Modeling:**\nPrivate data is modeled using path-based ownership (`/users/{userId}/dashboards/{dashboardId}`). This pattern is consistently applied across Dashboards, Reports, Alerts, Feedbacks, and Files.\n\n**QAPs (Rules are not Filters):**\nThe structure enables secure `list` operations. Because all user-related data is stored under `/users/{userId}`, listing operations can be performed securely by filtering based on the `userId` in the path, without needing to filter data based on its contents. This eliminates the need for complex query-based security rules.\n\n**Denormalization**: userId is duplicated in each subcollection to allow for simple security rules.\n\nThis structure promotes robust and easily debuggable security rules by making authorization intent explicit and minimizing the complexity of rule logic."
  }
}